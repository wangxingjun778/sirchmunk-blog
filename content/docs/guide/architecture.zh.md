---
title: 架构
weight: 0
---

Sirchmunk 采用清晰分离的层次化架构，遵循**关注点分离**原则。

## 系统概览

![Sirchmunk 架构](Sirchmunk_Architecture.png "Sirchmunk 高层架构图")

## 多阶段搜索管线

Sirchmunk 的核心是一个多阶段搜索管线，其设计原则是**每个阶段内最大并行化**与阶段之间**严格的依赖关系**。

### 阶段 0 — 知识簇复用

在任何计算开始之前，系统会检查是否有语义相似的查询已被回答过。将查询的轻量级嵌入通过余弦相似度与存储的知识簇进行比较。如果找到近似匹配，缓存的知识簇会在亚秒级时间内返回。

### 阶段 1 — 并行探测

四个独立的探测并发启动，收集多样化信号：

1. **LLM 关键词提取** — 多粒度关键词分解
2. **目录结构扫描** — 文件元数据收集和结构分析
3. **知识缓存查找** — 在现有知识簇中进行部分匹配搜索
4. **指定路径上下文加载** — 已知路径的预计算上下文

### 阶段 2 — 检索与排序

两种互补策略并行运行：

- **基于内容的检索** — IDF 加权关键词搜索原始文件内容
- **基于结构的排序** — LLM 引导的候选文件元数据评估

### 阶段 3 — 知识簇构建

结果被合并、去重，并通过蒙特卡洛证据采样处理。LLM 将证据片段合成为结构化的知识簇。

### 阶段 4 — 摘要或 ReAct 精炼

- **找到证据** → LLM 生成结构化简报
- **未找到证据** → ReAct 智能体启动进行迭代探索

### 阶段 5 — 持久化

有价值的知识簇连同其嵌入一起保存，供未来复用。

## 核心算法

### 蒙特卡洛证据采样

一种用于从大文档中提取证据的探索-利用方法：

![蒙特卡洛证据采样算法](Sirchmunk_MonteCarloSamplingAlgo.png "蒙特卡洛证据采样：三阶段启发式探索-利用策略")

1. **第一阶段 — 撒网**：模糊锚定 + 分层随机采样
2. **第二阶段 — 聚焦**：围绕高分种子的高斯重要性采样
3. **第三阶段 — 合成**：Top-K 片段 → LLM 摘要

### ReAct 智能体

自主的"思考 → 行动 → 观察"循环：

- 优先工具策略（关键词搜索 → 文件读取 → 知识查询 → 目录扫描）
- 双预算机制（Token 预算 + 循环次数）
- 记忆已探索的途径

## 设计原则

Sirchmunk 遵循 **SOLID 原则**：

- **单一职责** — 每个组件有一个明确的用途
- **开放封闭** — 通过抽象扩展，而非修改
- **里氏替换** — 所有实现遵守抽象契约
- **接口隔离** — 最小化、聚焦的接口
- **依赖倒置** — 高层逻辑依赖抽象

欲了解全面的技术分析，请阅读 [技术深度报告](/zh/blog/technical-deep-dive/)。
